<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Sticker Pack Manager</title>
      <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
   </head>
   <body>
      <main class="container">
         <header class="header">
            <h1>Sticker Pack Manager</h1>
         </header>
         <nav class="nav" aria-label="Primary">
            <a href="/" class="active" aria-current="page">Packs</a>
            <a href="/stickers">Stickers</a>
            <a href="/custom-packs">Custom Packs</a>
         </nav>
         <div class="actions-bar">
            <button class="btn btn-secondary" data-action="export-packs">Export All Packs (JSON)</button>
         </div>
         <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="Search packs" autocomplete="off">
         </div>
         <div class="controls-box">
            <div class="controls-row">
               <div class="control-group">
                  <label for="sortBy">Sort By:</label>
                  <select id="sortBy" class="control-select">
                     <option value="last_update_desc">Last Update (Newest)</option>
                     <option value="last_update_asc">Last Update (Oldest)</option>
                     <option value="title_asc">Title (A-Z)</option>
                     <option value="title_desc">Title (Z-A)</option>
                     <option value="name_asc">Name (A-Z)</option>
                     <option value="name_desc">Name (Z-A)</option>
                     <option value="artist_asc">Artist (A-Z)</option>
                     <option value="artist_desc">Artist (Z-A)</option>
                     <option value="count_desc">Sticker Count (High-Low)</option>
                     <option value="count_asc">Sticker Count (Low-High)</option>
                  </select>
               </div>
               <div class="control-group">
                  <label>Filters:</label>
                  <div class="filter-group">
                     <label class="filter-toggle" id="filterSignal">
                        <input type="checkbox" id="filterSignalCheck">
                        <span>On Signal</span>
                     </label>
                     <label class="filter-toggle" id="filterNeedsUpdate">
                        <input type="checkbox" id="filterNeedsUpdateCheck">
                        <span>Needs Update</span>
                     </label>
                     <label class="filter-toggle" id="filterCustomPacks">
                        <input type="checkbox" id="filterCustomPacksCheck">
                        <span>In Custom Packs</span>
                     </label>
                  </div>
               </div>
               <div class="control-group">
                  <label>&nbsp;</label>
                  <button id="updateAllPacksBtn" class="btn btn-warning">Update All Packs</button>
               </div>
            </div>
         </div>
         <div id="resultsCount" class="results-count" hidden></div>
         <div id="loading" class="loading">Loading packs...</div>
         <div id="packsGrid" class="packs-grid" hidden></div>
         <div id="emptyState" class="empty-state" hidden>
            <h2>No packs found</h2>
            <p>Try a different search term or filter</p>
         </div>
      </main>
      <!-- Modal for viewing pack stickers -->
      <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
         <div class="modal-content">
            <div class="modal-header">
               <div>
                  <div class="modal-title" id="modalTitle"></div>
                  <div id="modalSubtitle"></div>
               </div>
               <button class="close-btn" type="button" aria-label="Close dialog" data-action="close-modal">&times;</button>
            </div>
            <div class="modal-footer" style="border-bottom: 1px solid var(--border); padding-bottom: 16px; margin-bottom: 16px;">
               <button class="btn btn-secondary" data-action="export-current-pack">Export This Pack (JSON)</button>
            </div>
            <div class="modal-stickers-grid" id="modalStickers"></div>
         </div>
      </div>
      <!-- Pack Card Template -->
      <template id="packCardTemplate">
         <div class="pack-card">
            <div class="badge-container" data-badge-container></div>
            <div class="pack-thumbnail"></div>
            <div class="pack-header">
               <div class="pack-title" data-field="title"></div>
               <div class="pack-name" data-field="name"></div>
               <a class="pack-link" data-field="link" target="_blank" rel="noopener noreferrer">Open in Telegram</a>
            </div>
            <div class="pack-info">
               <span data-field="sticker_count"></span>
               <span data-field="last_update"></span>
            </div>
            <div class="pack-artist">
               <input type="text" class="artist-input" data-field="artist-input">
               <button type="button" class="artist-save" data-action="save-artist">Save</button>
            </div>
            <div class="pack-actions">
               <!-- Buttons will be added dynamically -->
            </div>
         </div>
      </template>
      <!-- Thumbnail Image Template -->
      <template id="thumbnailTemplate">
         <img data-field="src" alt="" loading="lazy">
      </template>
      <!-- Sticker Item Template -->
      <template id="stickerItemTemplate">
         <div class="sticker-item">
            <img data-field="image" alt="" loading="lazy">
         </div>
      </template>
      <!-- Load More Button Template -->
      <template id="loadMoreTemplate">
         <button class="btn btn-primary load-more-btn" data-action="load-more-stickers">
            <span data-field="text"></span>
         </button>
      </template>
      <script src="{{ url_for('static', filename='packs.js') }}" defer></script>
   </body>
</html>
